#!/bin/make -f

#- Muq makefile overview

# We need a separate Makefile and Makefile2 partly
# because I'd like to do
#  HDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config hdir`
#  MODDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config moddir`
# at the top of my Makefile, but
# splitting Makefile into Makefile + Makefile2
# is the only way I've found to get this effect,
# and partly because Makefile2 doesn't _exist_
# initially, Makefile has to create it from
# Makefile2.in via Configure.

# "One shell programming construction that you should not use
#  [...]  is `VAR=${VAR:-VALUE}'.  Old BSD shells, including
#  the Ultrix `sh', don't understand the colon, and complain
#  and die.  If you omit the colon, it works fine."
#   -- GNU autoconf.info: General Feature Tests

##########################################################################
#- header stuff

MAKE= @MAKE@
SHELL= @SH@

##########################################################################
#- all muq check check2 clean distclean

all:	Makefile2
	@(HDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config hdir` \
	 MODDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config moddir` \
	 BINDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config bindir` \
	 INFODIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config infodir` \
	 $(MAKE) -f Makefile2 all)

muq:	Makefile2
	@(HDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config hdir`	\
	 MODDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config moddir`	\
	 BINDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config bindir`	\
	 INFODIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config infodir`	\
	 $(MAKE) -f Makefile2 muq)

muq-export:	Makefile2
	@(HDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config hdir`	\
	 MODDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config moddir`	\
	 BINDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config bindir`	\
	 INFODIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config infodir`	\
	 $(MAKE) -f Makefile2 muq-export)

muq-import:	Makefile2
	@(HDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config hdir`	\
	 MODDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config moddir`	\
	 BINDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config bindir`	\
	 INFODIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config infodir`	\
	 $(MAKE) -f Makefile2 muq-import)

quickcheck:
	echo '"make quickcheck" has been renamed "make check"'
	echo '(The old "make check" is now "make torturetest")'

done:	Makefile2
	@(HDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config hdir`	\
	 MODDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config moddir`	\
	 BINDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config bindir`	\
	 INFODIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config infodir`	\
	 $(MAKE) -f Makefile2 done)

check:	Makefile2
	@(HDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config hdir`	\
	 MODDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config moddir`	\
	 BINDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config bindir`	\
	 INFODIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config infodir`	\
	 $(MAKE) -f Makefile2 check)

torturetest:	Makefile2
	@(HDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config hdir`	\
	 MODDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config moddir`	\
	 BINDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config bindir`	\
	 INFODIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config infodir`	\
	 $(MAKE) -f Makefile2 torturetest)

check2:	Makefile2
	@(HDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config hdir`	\
	 MODDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config moddir`	\
	 BINDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config bindir`	\
	 INFODIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config infodir`	\
	 $(MAKE) -f Makefile2 check2)

x-vm:	Makefile2
	@(HDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config hdir`	\
	 MODDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config moddir`	\
	 BINDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config bindir`	\
	 INFODIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config infodir`	\
	 $(MAKE) -f Makefile2 x-vm)

just-x-vm:	Makefile2
	@(HDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config hdir`	\
	 MODDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config moddir`	\
	 BINDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config bindir`	\
	 INFODIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config infodir`	\
	 $(MAKE) -f Makefile2 just-x-vm)

clean:	Makefile2
	@(HDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config hdir`	\
	 MODDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config moddir`	\
	 BINDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config bindir`	\
	 INFODIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config infodir`	\
	 $(MAKE) -f Makefile2 clean)

distclean:	Makefile2
	@(HDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config hdir`	\
	 MODDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config moddir`	\
	 BINDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config bindir`	\
	 INFODIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config infodir`	\
	 $(MAKE) -f Makefile2 distclean)

dis:	Makefile2
	@(HDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config hdir`	\
	 MODDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config moddir`	\
	 BINDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config bindir`	\
	 INFODIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config infodir`	\
	 $(MAKE) -f Makefile2 dis)

x-sha:	Makefile2
	@(HDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config hdir`	\
	 MODDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config moddir`	\
	 BINDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config bindir`	\
	 INFODIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config infodir`	\
	 $(MAKE) -f Makefile2 x-sha)

x-bnm:	Makefile2
	@(HDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config hdir`	\
	 MODDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config moddir`	\
	 BINDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config bindir`	\
	 INFODIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config infodir`	\
	 $(MAKE) -f Makefile2 x-bnm)

x-dil:	Makefile2
	@(HDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config hdir`	\
	 MODDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config moddir`	\
	 BINDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config bindir`	\
	 INFODIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config infodir`	\
	 $(MAKE) -f Makefile2 x-dil)

x-sil:	Makefile2
	@(HDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config hdir`	\
	 MODDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config moddir`	\
	 BINDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config bindir`	\
	 INFODIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config infodir`	\
	 $(MAKE) -f Makefile2 x-sil)

x-til:	Makefile2
	@(HDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config hdir`	\
	 MODDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config moddir`	\
	 BINDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config bindir`	\
	 INFODIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config infodir`	\
	 $(MAKE) -f Makefile2 x-til)

##########################################################################
#- pipetest1 pipetest2

pipetest1:	Makefile2
	@(HDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config hdir`	\
	 MODDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config moddir`	\
	 BINDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config bindir`	\
	 INFODIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config infodir`	\
	 $(MAKE) -f Makefile2 pipetest1)

pipetest2:	Makefile2
	@(HDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config hdir`	\
	 MODDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config moddir`	\
	 BINDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config bindir`	\
	 INFODIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config infodir`	\
	 $(MAKE) -f Makefile2 pipetest2)

##########################################################################
#- socktest1 socktest2

socktest1:	Makefile2
	@(HDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config hdir`	\
	 MODDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config moddir`	\
	 BINDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config bindir`	\
	 INFODIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config infodir`	\
	 $(MAKE) -f Makefile2 socktest1)

socktest2:	Makefile2
	@(HDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config hdir`	\
	 MODDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config moddir`	\
	 BINDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config bindir`	\
	 INFODIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config infodir`	\
	 $(MAKE) -f Makefile2 socktest2)

# Makefile2: Makefile2.in config.status # Gnu recommendation
# 	$(SHELL) config.status

config.status: Configure
	@$(SHELL) config.status --recheck

# Note: Config.h is currently built by Configure:
# Look near the end of Configure.in for the code.

Makefile2: Config.h.in Makefile2.in Configure 
	@$(SHELL) Configure --with-x

# 
# Dependencies on Configure.in commented out because various
# broken 'tar's (NEXTSTEP 3.2) seem to set dates to extraction
# time no matter what you tell them, which can result in spurious
# attempts to rebuild from Configure.in, which are disastrous
# when autoconfig isn't installed locally.
#   If you really do want to rebuild from Configure.in, do
# 'muq-deconfigure' followed by 'make'.
#   The /usr/local/bin/m4 stuff is because autoconf refuses to
# run on anything but GNU m4, and only looks in /usr/bin for it
# if M4 is not set.  You may need to set M4 by hand on your system
# (or hack the following two rules) before rebuilding Config.h and
# Configure, in the unlikely event you need to.

Config.h.in: # Configure.in
	@(export M4; \
	 test -z "${M4}"	   && 	\
	 test -x /usr/local/bin/m4 &&	\
	 M4=/usr/local/bin/m4; \
	 CDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config cdir` \
	 AUTOCONFIG=`$${MUQDIR-$${HOME}/muq/bin}/muq-config autoconfigdir` \
	 $(MAKE) -f Makefile3 Config.h.in)

Configure: # Configure.in
	@(export M4; \
	 test -z "${M4}"	   && 	\
	 test -x /usr/local/bin/m4 &&	\
	 M4=/usr/local/bin/m4; \
	 CDIR=`$${MUQDIR-$${HOME}/muq/bin}/muq-config cdir` \
	 AUTOCONFIG=`$${MUQDIR-$${HOME}/muq/bin}/muq-config autoconfigdir` \
	 $(MAKE) -f Makefile3 Configure)

##########################################################################
#- install db tags

install: 
	muq-install

db: 
	muq-db

tags: 
	muq-tags


##########################################################################
#- Makefile2 config.status configure

##########################################################################
#- Local variables
# Local Variables:
# shellscript-mode: t
# mode: outline-minor
# outline-regexp: "#-+"
# End:

